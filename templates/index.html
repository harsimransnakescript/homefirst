{% load static %}
<!DOCTYPE html>
<html>

<head>
  <title>DEV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    .content {
      display: none;
    }

    .preload {
      width: 100px;
      height: auto;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9;
    }
  </style>
</head>

<body>
  <h1>You are Patient Guide</h1>
  <!-- Start latest Chat Section -->
  <div class="chat_section">
    <div id="display">
      <section id="firstText"></section>
    </div>
    <div id="type-box">
      <fieldset>
        <input type="text" autocomplete="off" role="combobox" list="" id="input" name="browsers"
          placeholder="Ask me anything" class="form-control1">
        <datalist id="browsers" role="listbox">
          {% for question in questions %}
          <option value="{{ question }}">{{ question }}</option>
          {% endfor %}
        </datalist>
      </fieldset>
      <a><button id="send" onclick="send()" class="btn get_answer_ltest">SEND</button></a>
      <a><button id="ans-btn7" class="btn get_answer_ltest">CLEAR</button></a>
      <br>
    </div>
  </div>
  <!-- End latest Chat Section -->

<!-- script start -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
  $(document).click(function () {
    $("#browsers").hide();
  });
  /* Clicks within the dropdown won't make
     it past the dropdown itself */
  $("#input").click(function (e) {
    e.stopPropagation();
  });
</script>
<script>
  var input = document.getElementById('input');
  var display = document.getElementById('display');
  let onfocusfunc = function () {
    $(this).parent().addClass("expandbg");
  }
  let onBlurfunc = function () {
    $(this).parent().removeClass("expandbg");
    $(this).parent().addClass("round");
  }
  $(document).ready(function ($) {
    $(".form-control1").focus(onfocusfunc)
      .blur(onBlurfunc)
  });

  function send() {
    if (input.value != "") {
      var raw = $("#input").val();
      // alert(raw)
      $("#answer2").show();
      $("#hide_img2").show();
      $.ajax({
        type: "POST",
        data: {
          "raw": raw,
          "csrfmiddlewaretoken": '{{ csrf_token }}'
        },
        success: function (data) {
          console.log(data)
          $("#display div").last().html(data['fetch'])
          input.value = "";
          $("#browsers").remove();
        }
      })
      display.innerHTML += "<div>" + input.value + "</div>";  // question
      display.innerHTML += "<div><img style='text-align:center;' width='100' src='{% static 'images/loader.gif' %}'></div>";
      input.value = "";
      $("#browsers").remove();
      $(".form-control1").unbind();
    }
  }

  window.addEventListener("keydown", function (e) {
    if (e.keyCode === 13) {
      send();
    }
  });
</script>

<script>
  input.onfocus = function () {
    browsers.style.display = 'block';
  };
  for (let option of browsers.options) {
    option.onclick = function () {
      input.value = option.value;
      browsers.style.display = 'none';
    }
  };

  input.oninput = function () {
    currentFocus = -1;
    var text = input.value.toUpperCase();
    for (let option of browsers.options) {
      if (option.value.toUpperCase().indexOf(text) > -1) {
        option.style.display = "block";
      } else {
        option.style.display = "none";
      }
    };
  }
  var currentFocus = -1;
  input.onkeydown = function (e) {
    if (e.keyCode == 40) {
      currentFocus++
      addActive(browsers.options);
    }
    else if (e.keyCode == 38) {
      currentFocus--
      addActive(browsers.options);
    }
    else if (e.keyCode == 13) {
      e.preventDefault();
      if (currentFocus > -1) {
        if (browsers.options) browsers.options[currentFocus].click();
      }
    }
  }

  function addActive(x) {
    if (!x) return false;
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    x[currentFocus].classList.add("active");
  }
  function removeActive(x) {
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("active");
    }
  }
</script>

<script>
  $(document).ready(function () {
    $(".preload").fadeOut(function () {
      $(".content").fadeIn();
    });

    $.ajax({
      type: "GET",
      data: {
        "raw": '1',
        "csrfmiddlewaretoken": '{{ csrf_token }}'
      },
      success: function (data) {
        console.log(data)
      }
    })

    $("#ans-btn7").click(function () {
      location.reload()
    })
  });
</script>
</body>
</html>


