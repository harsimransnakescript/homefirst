{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel='stylesheet' href="static/css/icon.css">
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>

</head>

<body>
    <!-- header css start -->
    <header class="home-header">
        <nav class="navbar navbar-expand-md p-0">
            <div class="container-md">
                <a class="navbar-brand logo" href="#">
                    <img src="{% static 'images/header-logo.png' %}"> </a>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'products' %}">products</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">order management</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">contact </a>
                        </li>
                    </ul>
                    <div class="hi_there_btn">
            
                        <button class="btn" type="submit"><svg xmlns="http://www.w3.org/2000/svg" width="29" height="25"
                                viewBox="0 0 29 25" fill="none">
                                <path
                                    d="M19.4791 7.47778C17.6432 7.47778 16.1208 9.00017 16.1208 10.836C16.1208 12.6718 17.5985 14.1942 19.4791 14.1942C21.3149 14.1942 22.8373 12.6718 22.8373 10.836C22.8373 9.00017 21.3597 7.47778 19.4791 7.47778ZM19.4791 12.4032C18.6283 12.4032 17.9119 11.6867 17.9119 10.836C17.9119 9.98525 18.5835 9.26883 19.4791 9.26883C20.3298 9.26883 21.0462 9.98525 21.0462 10.836C21.0462 11.7315 20.3298 12.4032 19.4791 12.4032Z"
                                    fill="white" />
                                <path
                                    d="M9.18072 7.47778C7.3449 7.47778 5.82251 9.00017 5.82251 10.836C5.82251 12.6718 7.30012 14.1942 9.18072 14.1942C11.0165 14.1942 12.5389 12.6718 12.5389 10.836C12.5389 9.00017 11.0165 7.47778 9.18072 7.47778ZM9.18072 12.4032C8.32997 12.4032 7.61355 11.6867 7.61355 10.836C7.61355 9.98525 8.2852 9.26883 9.18072 9.26883C10.0315 9.26883 10.7479 9.98525 10.7479 10.836C10.7031 11.7315 10.0315 12.4032 9.18072 12.4032Z"
                                    fill="white" />
                                <path
                                    d="M20.106 2.50746H19.0762C18.9418 1.1194 17.7329 0 16.3 0H12.315C10.8821 0 9.67317 1.07463 9.53885 2.50746H8.28511C6.00153 2.50746 3.89705 3.44776 2.37467 4.97015C0.897054 6.49254 -0.0432444 8.59702 0.00153176 10.9254C0.0463079 15.5373 3.94183 19.1642 8.55377 19.1642H9.58362C9.85228 19.1642 10.0314 19.3881 10.0314 19.6567L9.89705 24.4925C9.89705 24.8507 10.2553 25.0746 10.5239 24.8955L18.4941 19.209C18.5388 19.1642 18.6284 19.1642 18.6732 19.1642H20.2851C22.5687 19.1642 24.6732 18.2239 26.1956 16.7015C27.718 15.1791 28.6582 13.0746 28.6582 10.7463C28.6135 6.1791 24.718 2.50746 20.106 2.50746ZM20.1508 16.3433H8.509C5.46422 16.3433 3.00153 13.8806 3.00153 10.8358C3.00153 7.79104 5.46422 5.32836 8.509 5.32836H20.1508C23.1956 5.32836 25.6582 7.79104 25.6582 10.8358C25.6582 13.8806 23.1956 16.3433 20.1508 16.3433Z"
                                    fill="white" />
                            </svg> hi there!</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    {% block content%}
    {% endblock %}
    <footer>
        <div class="container-md">
            <div class="footer-top">
                <div class="row">
                    <div class="col-lg-6 mb-3">
                        <div class="footer_left">
                            <div class="site-logo">
                                <a href=""><img src="{% static 'images/header-logo.png' %}"></a>
                            </div>
                            <p>Lorem ipsum, or lipsum as it is sometimes.</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3  mb-3">
                        <div class="footer_links">
                            <h2 class="footer-heading">links</h2>
                            <div class="site_links">
                                <a href="">privacy policy</a>
                                <a href="">FAQs</a>
                                <a href="">terms of service</a>
                                <a href="">contact us</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 d-md-flex justify-content-end  mb-3">
                        <div class="footer_social_links">
                            <h2 class="footer-heading">Social links</h2>
                            <div class="footer_icons">
                                <div class="social_icon facebook-icon">
                                    <a href="">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35"
                                            viewBox="0 0 35 35" fill="none">
                                            <circle cx="17.0056" cy="17.0056" r="16.5054" stroke="#656263"
                                                stroke-width="1.00033" />
                                            <path
                                                d="M19.961 17.8559L20.3137 15.3938H18.1082V13.7961C18.1082 13.1225 18.4163 12.4659 19.4041 12.4659H20.4067V10.3697C20.4067 10.3697 19.4969 10.2034 18.6269 10.2034C16.8106 10.2034 15.6234 11.3826 15.6234 13.5173V15.3938H13.6045V17.8559H15.6234V23.8079H18.1082V17.8559H19.961Z"
                                                fill="#656263" />
                                        </svg>
                                    </a>
                                </div>
                                <div class="social_icon instagram-icon">
                                    <a href="">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35"
                                            viewBox="0 0 35 35" fill="none">
                                            <circle cx="17.0212" cy="17.0056" r="16.5054" stroke="#656263"
                                                stroke-width="1.00033" />
                                            <path
                                                d="M17.0235 13.5171C15.0932 13.5171 13.5362 15.0744 13.5362 17.0051C13.5362 18.9358 15.0932 20.4931 17.0235 20.4931C18.9538 20.4931 20.5107 18.9358 20.5107 17.0051C20.5107 15.0744 18.9538 13.5171 17.0235 13.5171ZM17.0235 19.2728C15.7761 19.2728 14.7563 18.2558 14.7563 17.0051C14.7563 15.7544 15.7731 14.7375 17.0235 14.7375C18.2739 14.7375 19.2906 15.7544 19.2906 17.0051C19.2906 18.2558 18.2709 19.2728 17.0235 19.2728ZM21.4668 13.3744C21.4668 13.8267 21.1026 14.188 20.6534 14.188C20.2012 14.188 19.84 13.8237 19.84 13.3744C19.84 12.9251 20.2042 12.5609 20.6534 12.5609C21.1026 12.5609 21.4668 12.9251 21.4668 13.3744ZM23.7764 14.2001C23.7248 13.1103 23.4759 12.145 22.6777 11.3496C21.8826 10.5543 20.9174 10.3053 19.8278 10.2507C18.7049 10.1869 15.3391 10.1869 14.2161 10.2507C13.1296 10.3023 12.1644 10.5512 11.3662 11.3466C10.568 12.1419 10.3222 13.1073 10.2675 14.1971C10.2038 15.3203 10.2038 18.6869 10.2675 19.8101C10.3191 20.8999 10.568 21.8653 11.3662 22.6606C12.1644 23.456 13.1265 23.7049 14.2161 23.7596C15.3391 23.8233 18.7049 23.8233 19.8278 23.7596C20.9174 23.708 21.8826 23.459 22.6777 22.6606C23.4729 21.8653 23.7218 20.8999 23.7764 19.8101C23.8401 18.6869 23.8401 15.3233 23.7764 14.2001ZM22.3257 21.0153C22.0889 21.6103 21.6307 22.0687 21.0328 22.3085C20.1374 22.6637 18.0129 22.5817 17.0235 22.5817C16.0341 22.5817 13.9065 22.6606 13.0142 22.3085C12.4194 22.0717 11.9611 21.6133 11.7213 21.0153C11.3662 20.1198 11.4482 17.9948 11.4482 17.0051C11.4482 16.0155 11.3692 13.8875 11.7213 12.995C11.958 12.4 12.4163 11.9416 13.0142 11.7018C13.9096 11.3466 16.0341 11.4285 17.0235 11.4285C18.0129 11.4285 20.1405 11.3496 21.0328 11.7018C21.6276 11.9385 22.0859 12.3969 22.3257 12.995C22.6808 13.8905 22.5988 16.0155 22.5988 17.0051C22.5988 17.9948 22.6808 20.1228 22.3257 21.0153Z"
                                                fill="#656263" />
                                        </svg>
                                    </a>
                                </div>
                                <div class="social_icon twitter-icon">
                                    <a href="">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35"
                                            viewBox="0 0 35 35" fill="none">
                                            <circle cx="17.0369" cy="17.0056" r="16.5054" stroke="#656263"
                                                stroke-width="1.00033" />
                                            <path
                                                d="M24.6395 13.5934C24.6502 13.7422 24.6502 13.891 24.6502 14.0398C24.6502 18.5781 21.1434 23.8074 14.7339 23.8074C12.7592 23.8074 10.9249 23.244 9.38184 22.2663C9.6624 22.2981 9.93213 22.3088 10.2235 22.3088C11.8528 22.3088 13.3527 21.7667 14.5504 20.842C13.0182 20.8101 11.7341 19.8217 11.2917 18.4612C11.5075 18.4931 11.7233 18.5144 11.95 18.5144C12.2629 18.5144 12.5758 18.4718 12.8671 18.3975C11.2702 18.0786 10.0724 16.6969 10.0724 15.0282V14.9857C10.5364 15.2408 11.0759 15.4002 11.6478 15.4215C10.709 14.805 10.094 13.7528 10.094 12.5624C10.094 11.9247 10.2666 11.3401 10.5687 10.8299C12.2844 12.9131 14.8633 14.2736 17.7551 14.4224C17.7012 14.1673 17.6688 13.9016 17.6688 13.6359C17.6688 11.744 19.2226 10.2029 21.1541 10.2029C22.1576 10.2029 23.064 10.6174 23.7007 11.287C24.4883 11.1382 25.2437 10.8512 25.9127 10.458C25.6537 11.2551 25.1034 11.9247 24.3804 12.3498C25.0818 12.2755 25.7616 12.0841 26.3874 11.8184C25.9128 12.4986 25.3192 13.1044 24.6395 13.5934Z"
                                                fill="#656263" />
                                        </svg>
                                    </a>
                                </div>
                                <div class="social_icon google-icon">
                                    <a href="">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35"
                                            viewBox="0 0 35 35" fill="none">
                                            <circle cx="17.0535" cy="17.0056" r="16.5054" stroke="#656263"
                                                stroke-width="1.00033" />
                                            <path
                                                d="M20.2793 16.0307C20.3453 16.3741 20.3924 16.7174 20.3924 17.1629C20.3924 21.0512 17.7439 23.8074 13.7572 23.8074C9.94006 23.8074 6.84863 20.7635 6.84863 17.0051C6.84863 13.2467 9.94006 10.2029 13.7572 10.2029C15.6233 10.2029 17.1784 10.871 18.3848 11.9846L16.5092 13.7571C16.0003 13.2746 15.1049 12.7085 13.7572 12.7085C11.4009 12.7085 9.47819 14.6294 9.47819 17.0051C9.47819 19.3808 11.4009 21.3018 13.7572 21.3018C16.4904 21.3018 17.5177 19.3622 17.6779 18.3693H13.7572V16.0307H20.2793V16.0307ZM26.9505 16.2588V14.2842H24.9355V16.2588H22.9301V18.2428H24.9355V20.2173H26.9505V18.2428H28.9559V16.2588H26.9505Z"
                                                fill="#656263" />
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer_copyright text-center">
                    <p>©Copyright © 2019 - HOMEFIRST DME. ALL RIGHTS RESERVED.</p>
                </div>
            </div>
        </div>
        <div>
            <div class="chat-circle-outter" id="chat-circle">
              <div class="welcome-text">
                <p class="mb-0">
                  🙌 Welcome back!<br> How may I help you today?
                </p>
          
              </div>
            <div  class=" btn-raised chat-circle-image" >
              <img src="static/images/logo-img.png" class="img-fluid">
            </div>
           
            </div>
            <div class="chat-box">
              <div class="chat-box-header">
                <div class="chat_box_header_logo d-flex align-items-center">
                  <div class="header_logo">
                  <a href="" class="">
                    <img src="static/images/logo-img.png" class="img-fluid">
                  </a>
                  </div>
                  <div class="header_name">
                    <h1>Homefirst DME</h1>
                  </div>
                </div>
                <div class="header_btn d-flex" style="gap:4px;">
                  
                  <span class="chat-box-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                      <path d="M8.4713 1.07407L0.890182 8.65518" stroke="black" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                      <path d="M0.890182 1.07407L8.47129 8.65518" stroke="black" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                    </svg>
                  </span>
                </div>
              </div>
              <div class="chat-box-body">
                <div class="chat-box-overlay"></div>
                <div class="days text-center"><span>Today</span></div>
             
        
                <div class="chat-logs">
                  <div id="cm-msg-2" class="chat-msg user" style="">
                    <div class="answer">
                      <div class="cm-msg-text">Hi, it's great to see you! 👋</div>
                    </div>
                    
            
                  </div>
        
                  <!-- homefirst categories start -->
                <div class="home-first-category-main">
                  <div class="home-first-category-main-outter">
                  <div class="category-box">
                    <div class="category-card">
                    <div class="category-image">
                      <img src="static/images/nurse.png" class="img-fluid">
                      </div>
                      <div class="category-name">
                  <p class="mb-0">Nursing Care</p>
                      </div>
                      </div>
                  </div>
                  <div class="category-box">
                    <div class="category-card">
                    <div class="category-image">
                      <img src="static/images/physical.png" class="img-fluid">
                      </div>
                      <div class="category-name">
                  <p class="mb-0">Physical Therapy</p>
                      </div>
                      </div>
                  </div>
                  <div class="category-box">
                    <div class="category-card">
                    <div class="category-image">
                      <img src="static/images/home-health.png" class="img-fluid">
                      </div>
                      <div class="category-name">
                  <p class="mb-0">Home Health <br> Aides</p>
                      </div>
                  </div>
                  </div>
                  <div class="category-box">
                    <div class="category-card">
                    <div class="category-image">
                      <img src="static/images/nurse.png" class="img-fluid">
                      </div>
                      <div class="category-name">
                  <p class="mb-0">Nursing Care</p>
                      </div>
                      </div>
                  </div>
                  </div>
                  </div>
                  {% csrf_token %}
                  <div class="chat_section">
                      <div id="display" class="display">
                        
                        <fieldset>
                      
                          <datalist id="browsers" role="listbox">
                            {% for question in questions %}
                            <option value="{{ question }}">{{ question }}</option>
                            {% endfor %}
                          </datalist>
                        </fieldset>
                      
                      </div>
                    </div>
                 
        
                </div>
        
        
                <!--chat-log -->
              </div>
              <div class="chat-input">
                <form>
                  <input type="text" id="chat-input" placeholder="Type your message here" />
                  <button type="submit" onclick="send()" class="chat-submit" id="chat-submit">
                    
                    <!-- <img src="./images/logo_Sharif.png" class="send_btn"> -->
                    <div class="send_btn">
                      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="21" viewBox="0 0 22 21" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.323 0.292921C21.6027 0.564559 21.6974 0.967791 21.5668 1.33038L14.7188 20.3304C14.5794 20.7174 14.2107 20.9825 13.7889 20.9992C13.367 21.0159 12.9774 20.7808 12.8059 20.4062L9.05365 12.2076L0.611114 8.56384C0.225282 8.39731 -0.0167773 8.01894 0.000433928 7.60926C0.0176452 7.19959 0.290639 6.84162 0.689158 6.70617L20.2546 0.0561695C20.628 -0.0707359 21.0432 0.0212832 21.323 0.292921ZM11.062 11.6715L13.633 17.289L18.1322 4.80571L11.062 11.6715ZM16.6759 3.3915L3.8211 7.76063L9.60575 10.2573L16.6759 3.3915Z" fill="white"/>
                      </svg>
                    </div>
                  </button>
                </form>
                
              </div>
            </div>
          </div>
    </footer>
    <!-- site footer start end -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/script.js"></script>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>


<script>

function send() {
   var csrfToken = "{{ csrf_token }}";
    var input = document.getElementById("chat-input").value;
    var display = document.getElementById("display");
    var send = document.getElementById("send");
    var url = "/generate-stream"
    console.log(input);

      function getoldmessages(){
        const oldmessages = []
        const Allmessagedivs = display.querySelectorAll("div")
        for (let i = 0; i < Allmessagedivs.length; i++) {
          const messagediv = Allmessagedivs[i];
          if(messagediv.classList.contains("self"))
          {
            oldmessages.push({role:"user",content:messagediv.querySelector('.cm-msg-text > h3').innerHTML})
          }else if(messagediv.classList.contains("user")){
            oldmessages.push({role:"system",content:messagediv.querySelector('.cm-msg-text').innerHTML})
          }
        }
        return oldmessages
      }

      
      
         
    let ProductSelected = false; 
      
    // Function to handle streaming data from Django backend
        async function streamDataFromBackend() {
          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: {
                "X-CSRFToken": csrfToken,  // Include the CSRF token in the header
                "Content-Type": "application/json",  // Set the content type accordingly
            },
              body:JSON.stringify({
                "messages":[...getoldmessages(),{role:"user",content:input}],
                "ProductSelected": ProductSelected
              })
            });


            // Check if the response status is OK (HTTP status code 200)
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            // Create a ReadableStream from the response
            const stream = response.body;

            // Define a function to process the streamed data
            const processData = async (reader,messageelm) => {
              while (true) {
                const { done, value } = await reader.read();

                if (done) {
                  break; // Exit the loop when the stream ends
                }

                // Process the received data (value) here
      
                const textDecoder = new TextDecoder();

                // Decode the byte data to text
                const decodedText = textDecoder.decode(value);
                console.log(decodedText)
                if (isJSON(decodedText)) {
                  const wordData = JSON.parse(decodedText);
                  if (isJSON(decodedText)) {
                    const wordData = JSON.parse(decodedText);
                    if (wordData.type === 'products') {
                        const sliderdisplay = document.querySelector('.display');
                        const ticketSec = document.createElement('div');
                        ticketSec.classList.add('ticket_sec');
                  
                        const ticketOuter = document.createElement('div');
                        ticketOuter.classList.add('ticket_outer', 'mt-3');
                        const sliderContainer = document.createElement("div");
                        sliderContainer.className = "product-slider";


                        wordData.data.products.forEach((item) => {
                            const ticketInnerElem = document.createElement("div");
                            ticketInnerElem.className = "ticket_inner";
                
                            const categoryImageElem = document.createElement("div");
                            categoryImageElem.className = "category-image";
                
                            const imgElem = document.createElement("img");
                            imgElem.src = item.image;
                            imgElem.className = "img-fluid";
                
                            const productNameElem = document.createElement("div");
                            productNameElem.className = "product-name";
                            productNameElem.textContent = item.name;
                
                            const viewMoreElem = document.createElement("a");
                            viewMoreElem.textContent = "Select";
                            viewMoreElem.className = "view_more text-center";

                            viewMoreElem.addEventListener("click", function() {
                             
                              ProductSelected = true;
                              console.log("=====",ProductSelected)
                              console.log("Product selected:", item.name);
                              var fullVariable = "I have selected " + item.name
                              $("#chat-input").val(fullVariable);
                              sendRequestWithProductSelected();
                              $("#chat-submit").click();
                             

                            });
                
                            categoryImageElem.appendChild(imgElem);
                
                            ticketInnerElem.appendChild(categoryImageElem);
                            ticketInnerElem.appendChild(productNameElem);
                            ticketInnerElem.appendChild(viewMoreElem);
                
                            sliderContainer.appendChild(ticketInnerElem);
              
                        });
                        const prevBtn = document.createElement('button');
                        prevBtn.id = 'prevBtn';
                        prevBtn.classList.add('previous-btn');
                        prevBtn.style.display = 'block';
                        prevBtn.innerHTML = `
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 18 14" fill="none">
                            <path d="M1 7H17" stroke="#6097b4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M7 13L1 7L7 1" stroke="#6097b4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        `;

                        // Create the next button
                        const nextBtn = document.createElement('button');
                        nextBtn.id = 'nextBtn';
                        nextBtn.classList.add('next-btn');
                        nextBtn.style.display = 'block';
                        nextBtn.innerHTML = `
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 18 14" fill="none">
                            <path d="M17 7H1" stroke="#6097b4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M11 13L17 7L11 1" stroke="#6097b4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        `;
                        ticketOuter.appendChild(sliderContainer);
                        ticketSec.appendChild(ticketOuter);
                        ticketSec.appendChild(prevBtn);
                        ticketSec.appendChild(nextBtn);

                        sliderdisplay.appendChild(ticketSec);
                
                    
                        $('.product-slider').slick({
                          
                            slidesToShow: 1,
                            slidesToScroll: 1,
                        });
                  

                        $('#prevBtn').on('click', function() {
                            $('.product-slider').slick('slickPrev');
                        });

                        $('#nextBtn').on('click', function() {
                            $('.product-slider').slick('slickNext');
                        });
                    }

                }
                
                }else{
                  messageelm.append(decodedText);
                }
                $(".chat-logs")
                .stop()
                .animate({ scrollTop: $(".chat-logs")[0].scrollHeight }, 1000);

              }
            };
            // Start processing the streamed data
            const reader = stream.getReader();


            const elm = document.createElement("div");
            elm.id = "cm-msg-2";
            elm.className = "chat-msg user";

            const answerDiv = document.createElement("div");
            answerDiv.className = "answer";

            const cmMsgTextDiv = document.createElement("div");
            cmMsgTextDiv.className = "cm-msg-text";

            answerDiv.appendChild(cmMsgTextDiv);
            elm.appendChild(answerDiv);

            result=display.appendChild(elm);
            console.log("---",result)
            await processData(reader,cmMsgTextDiv);
          

          } catch (error) {
            console.error('An error occurred:', error);
          }
        }


   
      async function sendRequestWithProductSelected() {
        try {
          
          await new Promise((resolve) => setTimeout(resolve, 100));
      
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              "X-CSRFToken": csrfToken,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              "messages": [...getoldmessages(), { role: "user", content: input }],
              "ProductSelected": ProductSelected
            })
          });
      
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
      
          const stream = response.body;
      
      
          const processData = async (reader, messageelm) => {
            while (true) {
              const { done, value } = await reader.read();
      
              if (done) {
                break;
              }
      

              const textDecoder = new TextDecoder();
      

              const decodedText = textDecoder.decode(value);
              console.log(decodedText);
      
         
            }
          };
      
          const reader = stream.getReader();
      
  
        } catch (error) {
          console.error('An error occurred:', error);
        }
    }
    
    

    // Call the function to start streaming data
    streamDataFromBackend();

    //set the user input to the chatbox
    display.innerHTML=display.innerHTML+"<div class='chat-msg self'> <div class='cm-msg-text'><h3>"+input+"</h3></div></div>";

    document.getElementById("chat-input").value="";

   
    }

    

    function isJSON(str) {
      try {
        JSON.parse(str);
        return true;
      } catch (e) {
        return false;
      }
    }
   
</script>
    
    
    
</body>


</html>